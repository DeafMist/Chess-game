1) прописать скрытые шахи для фигур
2) прописать вариант, в котором королю стоит шах и фигура может пойти только в том случае, если пропадет шах
3) для пешек подкорректировать проверку хода по диагонали, чтобы, если нет ходов вперед, а по диагонали стоит своя фигура, ход не мог выполниться
4) для пешек прописать бой по диагонали, если там стоит вражеская фигура
5) прописать королю рокировку